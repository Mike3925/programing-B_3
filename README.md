# プログラミングB 課題3
## 課題内容
以下に挙げる 2 種類の検索を実現するプログラムを作成し，レポートにまとめよ．
1. 郵便番号を入力すると，対応する住所を出力する．
2. 住所名の一部を表す文字列を入力すると，その文字列を含む一連の住所およびそれらに対応する郵便番号のリストを出力する．
ただし，リストは郵便番号で昇順にソートすること．

ただし，プログラムは以下の 2 段階の処理を実行すること．
1.  前処理 
検索を容易にするための前処理を担当する．
郵便番号と住所を含むテキストファイル（付録参照）を入力として，構造体を利用してメモリに格納する．
2. 検索処理
（検索 1）もしくは（検索 2）を処理し，検索結果を画面に出力する．

プログラムの作成にあたっては，特段の理由がない限り，CLE の本課題フォルダに同梱のテンプレートプログラムに加筆して完成させること．
特に，入出力の際には，本テンプレートプログラムで定められている入出力の仕様を変更しないこと．
本プログラムは日本語の文字操作を含むので，文字コードに気を付けること．
テンプレートプログラムは UTF-8 の文字コードを使用して，作成している．
テキストエディタで開く際，あるいは保存する際，は文字コードの設定を UTF-8 に変更すること．
また，実行環境として，推奨環境である Msys2/MinGW，他に Windows Subsystem for Linux (WSL)，Linux を想定している．
もし，他の環境を利用する場合，文字コードに関連する問題が生じても，自身で調査し解決すること．
なお，Windows のコマンドプロンプト，PowerShell の利用者については，これらの環境に対応するためのコードをテンプレートプログラムにコメントとして追加しているので，よく読んでコメントを外して利用すること．

## 提出物
__プログラム＆レポート__
作成したソースプログラム，および，本課題フォルダに同梱の「レポートの書き方」にしたがって作成したレポート（PDF ファイルとする）を CLE に提出すること．
また，ソースプログラムの提出後，動作確認を slack で依頼すること．
動作確認依頼の方法は CLE にアップロードしている通りである．
動作確認依頼時に，「/動作確認 課題〇-学籍番号-氏名-OS 名-文字コード名」をメッセージ欄に入力し送信すること．
「動作確認を依頼しました」と表示されることを確認すること．
OS 名には，動作確認に使用した PC の OS 名を，Windows・Mac・Linux・その他，のいずれから選択し記入すること (Ubuntu，Debian，CentOS，Red Hat 等は Linux に含まれる)．
文字コード名には、sjis あるいは utf8 のうち、選択した方を記入すること．
提出ファイルの名前は「学籍番号下 4 桁.c」，「学籍番号下 4 桁.pdf」とすること．
例えば，学籍番号が 09B16099 であれば，ファイル名は 6099.c，6099.pdf とする．
ソースプログラムとレポートは異なるタイミングで提出してよい．
（むしろ，動作確認を早期に行えるので推奨．）

## 締切
| 項目 |期日 |
|:-----------|:------------|
|ソースコード|1/4 23:59 (演習の講義 14 回目の前日)|
|教員・TA による動作確認|基本的には、12/4~1/5 の演習の講義中|
|レポート| 1/8 23:59 (演習の講義 16 回目の前日)|

## 発展課題

以下の発展課題は義務ではないが，取り組んだ場合はプラス評価する．

絞り込み検索の機能を実装せよ．
ここでいう絞り込み検索とは，（検索 2）の検索結果に対して，さらに新たな文字列を用いて検索を行うことである．
たとえば，「大阪」で検索して抽出した住所の集合のうち，さらに「吹田」を含む住所を抽出して提示する行為を指す.
なお，絞り込み検索は 1 度だけでなく，ユーザが望む限り，何度でも繰り返し行えるように実装すること.
たとえば，「大阪」，「吹田」，「東」，「山」をすべて含むような住所の検索が行えねばならない.

また，本課題は，以下の 2 つの観点で工夫のしどころがある課題である．
レポートに，どのような工夫を行い，どの程度の効果が得られた（と考えられるか）を記載した場合，その程度に応じて加点評価を行う．

- 時間計算量（検索時間）の削減  
検索 1，検索 2，絞り込み検索の検索時間をどのようにすれば短縮できるか．
たとえば，郵便番号による検索（検索 1）については前処理段階で工夫を施しておこくことで効率の良い検索が可能になるかもしれない．
また，単純なプログラムであれば，検索 2 において入力された文字列（クエリ文字列）と「大阪」といった頻出地名の比較を多数回行うことになるが，この無駄を省くことによって検索時間を削減できる余地があるかもしれない．
- 空間計算量（メモリ消費量）の削減  
「広島県」や「大阪市」といった都道府県名，市町村区名は，住所データのなかで大量に現れる．
この特性を活かすことで，メモリ消費量を少なく抑えることができるかもしれない．

## プログラムの仕様
### 実行モード
本プログラムは，実行時に与える引数の有無に応じて，以下の 2 つのモードで動作する．
- インタラクティブモード (引数無し)
  - プログラム実行中に，検索モードと検索クエリを選択し，住所検索を行うモード．
  -  引数に何も指定せずに実行すると本モードで動作する．
例えば，(プログラム名をkadai3 と仮定し) ./kadai3
  - コーディング中の動作確認などに使うことを推奨
- ファイルモード (引数有り)
  - プログラム実行時に，検索モードと検索クエリの列を記入した入力ファイル名を引数として指定し，住所検索を行うモード
  - 引数に入力ファイル名を指定して実行すると本モードで動作する．例えば，./kadai3 input_a_utf.txt
  - 動作確認時は、本モードでテストを行う

### 出力の仕様
以下の通り、検索結果を出力すること．
- [郵便番号]\:[住所]，の形式で出力すること．
”:”の前後に空白を加えないこと
  - 例えば，5650871:大阪府吹田市山田丘
- 検索結果以外は，printf 等で標準出力しないこと．

## テストケース
提出するプログラムは，下記の手順でテストケースをクリアすることを提出前に確認しておくこと
- (プログラム名を kadai3 と仮定し) ./kadai3 input_a_utf.txt > myoutput.txt
  - kadai3 に検索クエリを入力し，標準出力の内容を myoutput.txt に保存
- diff myoutput.txt output_a_utf.txt を実行し，相違がないことを確認

なお，冒頭の課題内容でも述べた通り，検索結果は郵便番号で昇順にソートして出力したこと．
全ての住所を出力できていても，ソートできていない場合，動作確認が通過するとは限らないので注意すること．

| 項番 | 検索内容 | 期待する出力結果 |
|:-----------|:------------|:----------|
|基本 a| （検索 1）5650871| 5650871:大阪府吹田市山田丘|
|基本 b |（検索 2）小野原| 3691804:埼玉県秩父市荒川小野原<br>5620031:大阪府箕面市小野原東<br>5620032:大阪府箕面市小野原西<br>6692132:兵庫県篠山市今田町上小野原<br>6692133:兵庫県篠山市今田町下小野原<br>8912312:鹿児島県鹿屋市小野原町|
|発展|(検索2) 石橋<br>の実行後、絞り込み検索で,大阪|5600042:大阪府豊中市石橋麻田町<br>5630032:大阪府池田市石橋|

# 検証メモ
## 構造体のprefの変更
char [13] -> char * への変更
13byte x 124340 -> 8byte x 124340
620KB 削減
## sort方法の変更
mergesort から 組み込み関数qsort へ変更
実行時間が平均0.08秒(80ms)減少(統計的に有意)
qsortでは、sortの安定性は保たれず
## 検索2アルゴリズムの検討
入力の解釈
静岡県浜松市中央区野口町
### 正規表現
(?<pref>.{2,3}[都道府県])(?<city>((?:.+?郡(?:.+?[町村])?)|(?:.+?市(?:.+?区)?)|(?:.+?[市区町村])))(?<town>.*)

E5 9F BC